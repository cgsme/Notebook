# nginx

nginx有一个主进程（`mster process`）和几个工作进程（`worker process`）. 主进程的主要作用是去读取、解析配置并且管理维护工作进程。实际处理请求的是工作进程。

nginx采用基于事件的模型和依赖于操作系统的机制来在工作进程之间有效地分配请求。工作进程的数量在配置文件中定义，这个数量可以是固定的，也可以根据CPU可用核心的数量自动调整。

## 启动、停止和重新加载配置

1. 启动：

```shell
nginx nginx.conf
```

默认情况下nginx的配置文件名称为`nginx.conf`，并且配置文件路径默认为`/usr/local/nginx/conf`，`/etc/nginx`或者`/usr/local/etc/nginx`。


2. nginx命令语法：

```shell
nginx -s 信号
```

信号包含以下几种：

- stop 快速关闭
- quit 优雅关闭
- reload 重新加载配置文件，修改配置后必须重新加载配置文件才会使配置生效。nginx接受到重新加载配置的请求后，会先校验语法并尝试应用新的配置，如果执行成功，主进程会启动一个新的工作进程并发送一个停止的消息给旧的工作进程。如执行失败，主进程将会回滚配置继续使用旧的配置文件。旧的工作进程收到停止的命令后，将停止接受新的请求，并在退出之前会将已经接收到的请求执行完毕。
- reopen 重新打开日志文件

信号也可以通过Unix工具的方式发送nginx，比如`kill`工具。

`kill -s QUIT 1628  # 1628为假设的进程ID`  

通`ps`获取所有正在运行的nginx进程：

```shell
ps -ef | grep nginx
```

## 配置文件结构

nginx由配置文件中指定的被指令控制的模块组成。指令分为简单指令和块指令。一个简单的指令由名称和参数组成，以空格分隔，并以分号(;)结尾。块指令的结构和简单指令相同，不同的是块指令不以分号结尾，而是以一组用大括号（{和}）括起来的附加指令结尾。如果块指令可以在大括号内包含其他指令，则称为上线文（例如：`events`，`http`，`server` 和 `location`）。
放置在配置文件中的任何上下文之外的指令都视为是在主上下文之中。`events`和`http`指令放置在主上下文中，`server`在`http`中，`location`放在`server`中。
跟在`#`之后的内容是注释。

```conf
# 事件
events {
    # ...
}
# 请求
http {
    server {    # 配置文件可以包含多个server块，通过监听的端口和服务器名称来区分
        location / {    # location后跟一个 / 
            # ....
            root /data/www
        }
        location /images/ {
            root /data/images
        }
    }
    # ...
}

```

## 提供静态内容

